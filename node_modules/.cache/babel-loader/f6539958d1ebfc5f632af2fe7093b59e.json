{"ast":null,"code":"import _classCallCheck from \"/Users/mac/Documents/keyboardSTUDY/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/mac/Documents/keyboardSTUDY/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/mac/Documents/keyboardSTUDY/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/mac/Documents/keyboardSTUDY/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/mac/Documents/keyboardSTUDY/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/Users/mac/Documents/keyboardSTUDY/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"/Users/mac/Documents/keyboardSTUDY/src/keyboard.zoom.js\";\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport Keymaps from './keys.js'; // Keyboard2,\n//\n\nvar Keyboard2 =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(Keyboard2, _React$Component);\n\n  // Constructor, normal constructor in java\n  function Keyboard2(props) {\n    var _this;\n\n    _classCallCheck(this, Keyboard2);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Keyboard2).call(this, props)); // this is the state variables, which is very special in React.\n    // In react, once the state variables has changed by calling setState(),\n    // render() function is followed.\n    // this.props is the property passing by their parent DOM in this case,\n    // Watch class\n    // Please have a look doZoom, setViewport, and setPosition functions\n\n    _this.onKeyDown = function (ev) {\n      console.log(\"Key pressed: \" + ev.key + \"/\" + ev.keyCode);\n\n      if (ev.keyCode === 37) {\n        console.log(\"[KeyPressed] Left arrow clicked\");\n      } else if (ev.keyCode === 38) {\n        console.log(\"[KeyPressed] Top arrow clicked\");\n      } else if (ev.keyCode === 39) {\n        console.log(\"[KeyPressed] Right arrow clicked\");\n      } else if (ev.keyCode === 40) {\n        console.log(\"[KeyPressed] Down arrow clicked\");\n      } else {\n        var key = String.fromCharCode(ev.keyCode).toLocaleLowerCase();\n\n        if (ev.keyCode === 8) {\n          ev.returnValue = false;\n          ev.cancleBubble = true;\n          key = \"delete\";\n        } else if (ev.keyCode === 13) {\n          key = \"Enter\";\n        } // trigger\n\n\n        _this.props.callback(key); // flash\n\n\n        _this.flashKey(key);\n\n        ev.preventDefault();\n        ev.stopPropagation();\n        return false;\n      }\n    };\n\n    _this.onPointerDown = function (e) {\n      //console.log(\"[PointerDown]clientXY: \"+e.clientX + \":\"+e.clientY + \" - pageXY: \"+e.pageX+\n      //\":\" +e.pageY + \"- screenXY: \"+e.screenX+\":\"+e.screenY + \"- offsetXY: \"+e.nativeEvent.offsetX);\n      console.log(\"[PointerDown] xy - \" + e.nativeEvent.x + \"/\" + e.nativeEvent.y); //console.log(\"this.position.value: \"+this.viewport.x +\":\"+this.viewport.y);\n      //console.log(\"currentZoomLevel: \"+(this.position.width)+\":\"+this.original_dimensions.width);\n      // use e.nativeEvent.offsetX,Y for accuracy\n      //var x = e.nativeEvent.offsetX / (this.position.width/this.original_dimensions.width);\n      //var y = e.nativeEvent.offsetY / (this.position.height/this.original_dimensions.height);\n      //this.getKeyChar({x:x,y:y});\n\n      _this.onKeyClick(e); //e.preventDefault();\n      //e.stopPropagation();\n\n    };\n\n    _this.componentDidUpdate = function () {\n      console.log(\"========componentDidUpdate=======\");\n      /*\n      window.setTimeout(() => {\n      \tconsole.log(\"timeout\");\n      },500);*/\n\n      _this.offsetTop = ReactDOM.findDOMNode(_assertThisInitialized(_assertThisInitialized(_this))).offsetTop;\n      _this.offsetLeft = ReactDOM.findDOMNode(_assertThisInitialized(_assertThisInitialized(_this))).offsetLeft;\n    };\n\n    _this.getWindowDimension = function () {\n      return {\n        width: _this.original_dimensions.width * _this.env.originalScale,\n        height: _this.original_dimensions.height * _this.env.originalScale\n      };\n    };\n\n    _this.reset = function (animated) {\n      // console.log(\"[Reset] reser called.. originDim - \"+this.original_dimensions.width+\":\"+this.original_dimensions.height);\n      _this.setViewPort({\n        x: 0,\n        y: 0,\n        width: _this.original_dimensions.width,\n        height: _this.original_dimensions.height\n      }, animated === true);\n\n      _this.clearResetTimeout();\n\n      _this.in_starting_position = true;\n    };\n\n    _this.setViewPort = function (viewport, animated) {\n      var windowDim = _this.getWindowDimension();\n\n      var scale_x = windowDim.width / viewport.width;\n      var scale_y = windowDim.height / viewport.height; // console.log(\"windowDim - \"+windowDim.width +\":\"+windowDim.height);\n      // console.log(\"[setViewport] called.. originDim - \"+viewport.width+\":\"+viewport.height);\n      // console.log(\"Scale XY - \"+scale_x +\":\"+scale_y);\n\n      var width = scale_x * _this.original_dimensions.width;\n      var height = scale_y * _this.original_dimensions.height;\n      var x = -1 * viewport.x * scale_x;\n      var y = -1 * viewport.y * scale_y;\n\n      _this.setPosition({\n        x: x,\n        y: y,\n        width: width,\n        height: height\n      }, animated);\n\n      _this.viewport = viewport;\n    };\n\n    _this.setPosition = function (position, animated) {\n      if (animated === false) {//img.css -webkit-transition none\n        //img.css -webkit-transition all 0.001s ease-out\n      }\n\n      console.log(\"Left/Top/Width/Height: \" + position.x + \"/\" + position.y + \"/\" + position.width + \"/\" + position.height);\n\n      _this.setState({\n        imgStyle: {\n          left: position.x,\n          top: position.y,\n          width: position.width,\n          height: position.height\n        }\n      });\n\n      _this.position = position;\n    };\n\n    _this.clearResetTimeout = function () {\n      if (_this.resetTimeout !== undefined) {\n        window.clearTimeout(_this.resetTimeout);\n      }\n\n      _this.resetTimeout = undefined;\n    };\n\n    _this.onKeyClick = function (e) {\n      //e.preventDefault();\n      //e.stopPropagation();\n      // console.log(\"[2Click before doZoom] eventOffset => \"+e.nativeEvent.offsetX + \"/\"+e.nativeEvent.offsetY);\n      var currentZoomX = _this.getXZoom();\n\n      var currentZoomY = _this.getYZoom();\n\n      var currentZoomVal = _this.getZoom();\n\n      var scaleFactor = _this.env.zoomFactor;\n      var centerBias = _this.env.centerBias;\n      var maxZoom = _this.env.maxZoom;\n\n      _this.clearResetTimeout(); //Assuming mouse\n\n\n      if (_this.env.isTouchEnabled) {\n        console.log(\"true\");\n      } else {\n        var x = e.nativeEvent.offsetX / currentZoomX + _this.viewport.x;\n        var y = e.nativeEvent.offsetY / currentZoomY + _this.viewport.y;\n        console.log(\"[Click before doZoom] eventOffset => \" + e.nativeEvent.offsetX + \"/\" + e.nativeEvent.offsetY);\n        console.log(\"[Click before doZoom] curZoom and Viewport => \" + currentZoomX + \"/\" + currentZoomY + \"/\" + _this.viewport.x + \"/\" + _this.viewport.y);\n        console.log(\"[Click before doZoom] xy => \" + x + \"/\" + y);\n\n        _this.doZoom(x, y, scaleFactor, currentZoomVal, maxZoom, centerBias);\n\n        _this.resetTimeoutFunc();\n      }\n\n      return false;\n    };\n\n    _this.onFingerTouch = function (e) {\n      //e.preventDefault();\n      //e.stopPropagation();\n      var currentZoomX = _this.getXZoom();\n\n      var currentZoomY = _this.getYZoom();\n\n      var currentZoomVal = _this.getZoom();\n\n      var scaleFactor = _this.env.zoomFactor;\n      var centerBias = _this.env.centerBias;\n      var maxZoom = _this.env.maxZoom;\n\n      _this.clearResetTimeout();\n\n      var touch = e.nativeEvent.changedTouches[0]; //e.nativeEvent.changedTouches[0];\n      // console.log(\"touch start x: \" + touch.clientX + \"; y: \" + touch.clientY);\n\n      _this.clearResetTimeout(); //Assuming mouse\n\n\n      if (_this.env.isTouchEnabled) {} else {\n        //pageX includes scroll offset Value\n        // console.log(\"[offset] - \"+this.offsetLeft + \"/\" + this.offsetTop);\n        var x = (touch.pageX - _this.offsetLeft) / currentZoomX + _this.viewport.x;\n        var y = (touch.pageY - _this.offsetTop) / currentZoomY + _this.viewport.y; //console.log(\"[Click before doZoom] touchXY => \"+touch.clientX + \"/\"+touch.clientY);\n        // console.log(\"[Click before doZoom] curZoom and Viewport => \"+ currentZoomX + \"/\" + currentZoomY + \"/\"+ this.viewport.x + \"/\"+this.viewport.y);\n        // console.log(\"[Click before doZoom] xy => \"+x + \"/\"+y);\n\n        _this.doZoom(x, y, scaleFactor, currentZoomVal, maxZoom, centerBias);\n\n        _this.resetTimeoutFunc();\n      }\n\n      return false;\n    };\n\n    _this.resetTimeoutFunc = function () {\n      _this.clearResetTimeout();\n\n      var resetTimeout = _this.env.resetTimeout;\n      _this.resetTimeout = window.setTimeout(_this.reset, resetTimeout);\n    };\n\n    _this.doZoom = function (x, y, scaleFactor, currentZoomVal, maxZoom, centerBias) {\n      //var zoomtouch_event = jQuery.Event(\"zb_zoom\")\n      //zoomtouch_event.x = x;, zoomtouch_event.y = y;\n      //this.element.trigger(zoomtouch_event);\n      // console.log(\"[Debug] scaleFactor/ CurrnetZoomVal / maxZoom -> \" + scaleFactor + \"/ \"+currentZoomVal +\"/ \"+maxZoom);\n      if (scaleFactor * currentZoomVal > maxZoom) {\n        //console.log(\"Exceeded maxZoom \");\n        var key = _this.getKeyChar({\n          x: x,\n          y: y\n        });\n\n        if (key !== null) {\n          //this.element.trigger(zoomkey_event);\n          //this.flashkey(zoomkey_event.key);\n          console.log(\"[doZoom] Key is not null\");\n\n          _this.props.onKeyCharReceived(key);\n\n          _this.flashKey(key);\n        }\n\n        _this.reset();\n\n        return;\n      } else {\n        _this.in_starting_position = false;\n        var newViewportWidth = _this.viewport.width / scaleFactor;\n        var newViewportHeight = _this.viewport.height / scaleFactor;\n        var centeredX = x - newViewportWidth / 2;\n        var centeredY = y - newViewportHeight / 2;\n        var biasedViewportX = x - newViewportWidth * (x - _this.viewport.x) / _this.viewport.width;\n        var biasedViewportY = y - newViewportHeight * (y - _this.viewport.y) / _this.viewport.height;\n\n        _this.setViewPort({\n          width: newViewportWidth,\n          height: newViewportHeight,\n          x: biasedViewportX * (1 - centerBias) + centeredX * centerBias,\n          y: biasedViewportY * (1 - centerBias) + centeredY * centerBias\n        });\n      }\n    };\n\n    _this.getXZoom = function () {\n      return _this.position.width / _this.original_dimensions.width;\n    };\n\n    _this.getYZoom = function () {\n      return _this.position.height / _this.original_dimensions.height;\n    };\n\n    _this.getZoom = function () {\n      return Math.max(_this.getXZoom(), _this.getYZoom());\n    };\n\n    _this.flash = function (text, duration, color) {\n      duration = duration || 250;\n      color = color || \"white\"; //window.clearTimeout(this.flashTimeout);\n\n      _this.setState({\n        overlayStyle: {\n          opacity: 0.95,\n          color: color\n        },\n        overlayText: text\n      });\n\n      setTimeout(function () {\n        this.setState({\n          overlayStyle: {\n            opacity: 0\n          }\n        });\n      }.bind(_assertThisInitialized(_assertThisInitialized(_this))), duration);\n    };\n\n    _this.flashKey = function (key) {\n      if (key === \"delete\") {\n        //this.flash(\"&#9224;\");\n        _this.flash(\"&#x232B\");\n      } else if (key === \"enter\") {\n        _this.flash(\"&#9252;\");\n      } else if (key === \" \") {\n        _this.flash(\"&#9251;\");\n      } else {\n        _this.flash(key);\n      }\n    };\n\n    _this.state = {\n      swiped: false,\n      original_position: {\n        x: 0,\n        y: 0,\n        width: 0,\n        height: 0\n      },\n      //ignore\n      original_dimensions: {\n        width: 0,\n        height: 0\n      },\n      //ignore\n      font_size: 0,\n      // haven't use\n      // When user touch or click, imgStyle value has changes so that\n      // \tthe class re-render their html componenets\n      imgStyle: {\n        left: 0,\n        top: 0,\n        width: _this.props.width,\n        height: _this.props.height\n      },\n      overlayStyle: {\n        opacity: 0,\n        color: \"white\"\n      },\n      overlayText: \"\"\n    };\n    _this.in_starting_position = true;\n    _this.original_position = {\n      x: 0,\n      y: 0\n    };\n    _this.original_dimensions = {\n      width: 0,\n      height: 0\n    };\n    _this.displaySize = _this.props.displaySize; // this configuration is from original zoomboard code\n\n    _this.keyboardImg = null;\n    _this.env = {\n      keyboardNames: [\"ZB\", \"#\"],\n      zoomFactor: 2.2,\n      originalScale: 0.12,\n      maxZoom: 1.0,\n      resetOnMaxZoom: true,\n      resetTimeout: 1000,\n      centerBias: 0.05,\n      animTime: 0.1,\n      minSwipeX: 40,\n      minSwipeY: 1,\n      max_key_error_distance: 2,\n      useRealKeyboard: true\n    };\n    _this._onTouchStart = _this._onTouchStart.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this._onTouchMove = _this._onTouchMove.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this._onTouchEnd = _this._onTouchEnd.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this._swipe = {};\n    _this.startX = 0;\n    _this.startY = 0; // register Event\n\n    _this.onLoad = _this.onLoad.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.onKeyDown = _this.onKeyDown.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.onPointerDown = _this.onPointerDown.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    return _this;\n  }\n\n  _createClass(Keyboard2, [{\n    key: \"_onTouchStart\",\n    value: function _onTouchStart(e) {\n      var touch = e.nativeEvent.touches[0];\n      this.startX = touch.clientX;\n      this.startY = touch.clientY;\n      this._swipe = {\n        x: touch.clientX,\n        y: touch.clentY\n      }; // console.log(\"touch start x: \" + touch.clientX + \"; y: \" + touch.clientY);\n\n      this.setState({\n        swiped: false\n      });\n    }\n  }, {\n    key: \"_onTouchMove\",\n    value: function _onTouchMove(e) {\n      if (e.changedTouches && e.changedTouches.length) {\n        var touch = e.nativeEvent.changedTouches[0]; // console.log(\"touch move x: \" + touch.clientX + \"; y: \" + touch.clientY);\n\n        this._swipe.swiping = true;\n      }\n    }\n  }, {\n    key: \"_onTouchMove\",\n    value: function _onTouchMove(e) {\n      if (e.changedTouches && e.changedTouches.length) {\n        var touch = e.nativeEvent.changedTouches[0];\n        console.log(\"touch move x: \" + touch.clientX + \"; y: \" + touch.clientY);\n        this._swipe.swiping = true;\n      }\n    }\n  }, {\n    key: \"_onTouchEnd\",\n    value: function _onTouchEnd(e) {\n      var touch = e.nativeEvent.changedTouches[0];\n      console.log(\" touch.clientY: \" + touch.clientY + \"; this._swipe.y: \" + this._swipe.y);\n      var dx = touch.clientX - this.startX;\n      var dy = touch.clientY - this.startY;\n      console.log(\"dx: \" + dx + \"; dy: \" + dy);\n\n      if (this._swipe.swiping) {\n        if (Math.abs(dx) > this.env.minSwipeX) {\n          if (dx > 0) {\n            //swipe to the right\n            this.onSwipe(\"right\");\n            console.log(\"right\");\n          } else if (dx < 0) {\n            //swipe to the Left\n            this.onSwipe(\"left\");\n            console.log(\"left\");\n          }\n        } else if (Math.abs(dy) > this.env.minSwipeY) {\n          if (dy > 0) {\n            //swipe down\n            this.onSwipe(\"down\");\n            console.log(\"swipe down\");\n          } else if (dy < 0) {\n            //swipe up\n            this.onSwipe(\"up\");\n            console.log(\"swipe up\");\n          }\n        }\n\n        this.props.onSwiped && this.props.onSwiped();\n        console.log(\"touch end x: \" + touch.clientX + \"; y: \" + touch.clientY);\n        this.setState({\n          swiped: true\n        });\n      } else {\n        this.onFingerTouch(e);\n      }\n\n      this._swipe = {};\n    }\n  }, {\n    key: \"onSwipe\",\n    value: function onSwipe(direction) {\n      if (direction == \"left\") {\n        var key = \"delete\";\n        this.props.callback(key);\n      } else if (direction == \"right\") {} else if (direction == \"up\") {\n        var imgSrc = document.getElementById(\"keyboardtype\").src;\n        console.log(\"imgSrc: \" + imgSrc);\n\n        if (imgSrc.split(\"/\")[imgSrc.split(\"/\").length - 1] == \"ZoomBoard3b.png\") {\n          document.getElementById(\"keyboardtype\").src = \"/images/symbols3b.png\";\n        } else {\n          document.getElementById(\"keyboardtype\").src = \"/images/ZoomBoard3b.png\";\n        }\n      } else if (direction == \"down\") {}\n    } // When the image is loaded, we recalculate the img size to fit into our\n    // \tfixed width and height\n\n  }, {\n    key: \"onLoad\",\n    value: function onLoad(_ref) {\n      var img = _ref.target;\n      console.log(\"image naturalSize: \" + img.naturalWidth + \":\" + img.naturalHeight);\n      this.original_dimensions = {\n        width: img.naturalWidth,\n        height: img.naturalHeight\n      };\n      console.log(\"[onLoad]  - \" + this.original_dimensions.width + \":\" + this.original_dimensions.height);\n      this.env.originalScale = this.displaySize.width / this.original_dimensions.width;\n      this.setState({\n        original_scale: this.displaySize.width / this.original_dimensions.width\n      });\n      this.reset();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var size = this.getWindowDimension();\n      var style = {\n        width: size.width,\n        height: size.height\n      };\n      var overlayStyle = {\n        width: size.width,\n        height: size.height,\n        opacity: this.state.overlayStyle.opacity,\n        color: this.state.overlayStyle.color,\n        fontSize: size.height / 1.2 + \"px\"\n      };\n      var font_height = {\n        fontSize: size.height / 1.2\n      };\n      console.log(\"[render] \" + size.width);\n      return React.createElement(\"div\", {\n        className: \"container\",\n        style: style,\n        onKeyDown: this.onKeyDown,\n        tabIndex: \"0\",\n        onPointerDown: this.onPointerDown,\n        onTouchStart: this._onTouchStart,\n        onTouchMove: this._onTouchMove,\n        onTouchEnd: this._onTouchEnd,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 247\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        id: \"keyboardtype\",\n        className: \"KB\",\n        alt: \"kb\",\n        src: \"/images/ZoomBoard3b.png\",\n        onLoad: this.onLoad,\n        style: this.state.imgStyle,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 252\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"overlay\",\n        style: overlayStyle,\n        dangerouslySetInnerHTML: {\n          __html: this.state.overlayText\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 255\n        },\n        __self: this\n      }));\n    }\n  }, {\n    key: \"getKeyChar\",\n    value: function getKeyChar(point) {\n      console.log(\"point.x: \" + point.x + \"; point.y: \" + point.y);\n      var min_distance = false,\n          min_distance_key = null;\n      var max_key_error_distance_squared = Math.pow(this.env.max_key_error_distance, 2);\n      console.log(\"max_key_error_distance_squared: \" + max_key_error_distance_squared);\n      var keys = Keymaps.keys;\n\n      for (var i = 0, len = keys.length; i < len; i++) {\n        var key = keys[i];\n\n        if (key.x <= point.x && key.y <= point.y && key.x + key.width >= point.x && key.y + key.height >= point.y) {\n          return key.key;\n        } else {\n          var key_center_x = key.x + key.width / 2;\n          var key_center_y = key.y + key.height / 2;\n          var dx = point.x - key_center_x;\n          var dy = point.y - key_center_y;\n          var dsquared = Math.pow(dx, 2) + Math.pow(dy, 2);\n\n          if ((min_distance_key === null || dsquared < min_distance) && dsquared < max_key_error_distance_squared * Math.pow(Math.min(key.width, key.height), 2)) {\n            min_distance = dsquared;\n            min_distance_key = key.key;\n          }\n        }\n      }\n\n      return min_distance_key;\n    }\n  }]);\n\n  return Keyboard2;\n}(React.Component);\n\nexport default Keyboard2;","map":{"version":3,"sources":["/Users/mac/Documents/keyboardSTUDY/src/keyboard.zoom.js"],"names":["React","ReactDOM","Keymaps","Keyboard2","props","onKeyDown","ev","console","log","key","keyCode","String","fromCharCode","toLocaleLowerCase","returnValue","cancleBubble","callback","flashKey","preventDefault","stopPropagation","onPointerDown","e","nativeEvent","x","y","onKeyClick","componentDidUpdate","offsetTop","findDOMNode","offsetLeft","getWindowDimension","width","original_dimensions","env","originalScale","height","reset","animated","setViewPort","clearResetTimeout","in_starting_position","viewport","windowDim","scale_x","scale_y","setPosition","position","setState","imgStyle","left","top","resetTimeout","undefined","window","clearTimeout","currentZoomX","getXZoom","currentZoomY","getYZoom","currentZoomVal","getZoom","scaleFactor","zoomFactor","centerBias","maxZoom","isTouchEnabled","offsetX","offsetY","doZoom","resetTimeoutFunc","onFingerTouch","touch","changedTouches","pageX","pageY","setTimeout","getKeyChar","onKeyCharReceived","newViewportWidth","newViewportHeight","centeredX","centeredY","biasedViewportX","biasedViewportY","Math","max","flash","text","duration","color","overlayStyle","opacity","overlayText","bind","state","swiped","original_position","font_size","displaySize","keyboardImg","keyboardNames","resetOnMaxZoom","animTime","minSwipeX","minSwipeY","max_key_error_distance","useRealKeyboard","_onTouchStart","_onTouchMove","_onTouchEnd","_swipe","startX","startY","onLoad","touches","clientX","clientY","clentY","length","swiping","dx","dy","abs","onSwipe","onSwiped","direction","imgSrc","document","getElementById","src","split","img","target","naturalWidth","naturalHeight","original_scale","size","style","fontSize","font_height","__html","point","min_distance","min_distance_key","max_key_error_distance_squared","pow","keys","i","len","key_center_x","key_center_y","dsquared","min","Component"],"mappings":";;;;;;;AACA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,QAAP,MAAqB,WAArB;AACA,OAAOC,OAAP,MAAoB,WAApB,C,CAEA;AACA;;IACMC,S;;;;;AAEL;AACA,qBAAYC,KAAZ,EAAkB;AAAA;;AAAA;;AACjB,mFAAMA,KAAN,GADiB,CAEjB;AACA;AACA;AACA;AACA;AAEA;;AARiB,UAmKlBC,SAnKkB,GAmKN,UAACC,EAAD,EAAQ;AACnBC,MAAAA,OAAO,CAACC,GAAR,CAAY,kBAAkBF,EAAE,CAACG,GAArB,GAA2B,GAA3B,GAAgCH,EAAE,CAACI,OAA/C;;AACA,UAAGJ,EAAE,CAACI,OAAH,KAAe,EAAlB,EAAqB;AACpBH,QAAAA,OAAO,CAACC,GAAR,CAAY,iCAAZ;AACA,OAFD,MAEM,IAAGF,EAAE,CAACI,OAAH,KAAe,EAAlB,EAAqB;AAC1BH,QAAAA,OAAO,CAACC,GAAR,CAAY,gCAAZ;AACA,OAFK,MAEA,IAAGF,EAAE,CAACI,OAAH,KAAe,EAAlB,EAAqB;AAC1BH,QAAAA,OAAO,CAACC,GAAR,CAAY,kCAAZ;AACA,OAFK,MAEA,IAAGF,EAAE,CAACI,OAAH,KAAe,EAAlB,EAAqB;AAC1BH,QAAAA,OAAO,CAACC,GAAR,CAAY,iCAAZ;AACA,OAFK,MAED;AACJ,YAAIC,GAAG,GAAGE,MAAM,CAACC,YAAP,CAAoBN,EAAE,CAACI,OAAvB,EAAgCG,iBAAhC,EAAV;;AACA,YAAGP,EAAE,CAACI,OAAH,KAAe,CAAlB,EAAoB;AACnBJ,UAAAA,EAAE,CAACQ,WAAH,GAAiB,KAAjB;AACAR,UAAAA,EAAE,CAACS,YAAH,GAAkB,IAAlB;AACAN,UAAAA,GAAG,GAAG,QAAN;AACA,SAJD,MAIM,IAAGH,EAAE,CAACI,OAAH,KAAe,EAAlB,EAAqB;AAC1BD,UAAAA,GAAG,GAAG,OAAN;AACA,SARG,CASJ;;;AACA,cAAKL,KAAL,CAAWY,QAAX,CAAoBP,GAApB,EAVI,CAWJ;;;AACA,cAAKQ,QAAL,CAAcR,GAAd;;AACAH,QAAAA,EAAE,CAACY,cAAH;AACAZ,QAAAA,EAAE,CAACa,eAAH;AACA,eAAO,KAAP;AACA;AACD,KA9LiB;;AAAA,UAiMlBC,aAjMkB,GAiMF,UAACC,CAAD,EAAO;AACtB;AACA;AACAd,MAAAA,OAAO,CAACC,GAAR,CAAY,wBAAsBa,CAAC,CAACC,WAAF,CAAcC,CAApC,GAAwC,GAAxC,GAA4CF,CAAC,CAACC,WAAF,CAAcE,CAAtE,EAHsB,CAItB;AACA;AACA;AACA;AACA;AACA;;AACA,YAAKC,UAAL,CAAgBJ,CAAhB,EAVsB,CAWtB;AACA;;AACA,KA9MiB;;AAAA,UAgNlBK,kBAhNkB,GAgNG,YAAM;AAC1BnB,MAAAA,OAAO,CAACC,GAAR,CAAY,mCAAZ;AACA;;;;;AAIA,YAAKmB,SAAL,GAAiB1B,QAAQ,CAAC2B,WAAT,wDAA2BD,SAA5C;AACA,YAAKE,UAAL,GAAkB5B,QAAQ,CAAC2B,WAAT,wDAA2BC,UAA7C;AACA,KAxNiB;;AAAA,UA0PlBC,kBA1PkB,GA0PG,YAAM;AAC1B,aAAO;AACNC,QAAAA,KAAK,EAAE,MAAKC,mBAAL,CAAyBD,KAAzB,GAAiC,MAAKE,GAAL,CAASC,aAD3C;AAENC,QAAAA,MAAM,EAAE,MAAKH,mBAAL,CAAyBG,MAAzB,GAAkC,MAAKF,GAAL,CAASC;AAF7C,OAAP;AAIA,KA/PiB;;AAAA,UAiQlBE,KAjQkB,GAiQV,UAACC,QAAD,EAAc;AACrB;AACA,YAAKC,WAAL,CAAiB;AAACf,QAAAA,CAAC,EAAC,CAAH;AAAOC,QAAAA,CAAC,EAAC,CAAT;AAAYO,QAAAA,KAAK,EAAE,MAAKC,mBAAL,CAAyBD,KAA5C;AAAmDI,QAAAA,MAAM,EAAC,MAAKH,mBAAL,CAAyBG;AAAnF,OAAjB,EACCE,QAAQ,KAAK,IADd;;AAEA,YAAKE,iBAAL;;AACA,YAAKC,oBAAL,GAA4B,IAA5B;AACA,KAvQiB;;AAAA,UAyQlBF,WAzQkB,GAyQJ,UAACG,QAAD,EAAUJ,QAAV,EAAsB;AACnC,UAAIK,SAAS,GAAG,MAAKZ,kBAAL,EAAhB;;AACA,UAAIa,OAAO,GAAGD,SAAS,CAACX,KAAV,GAAgBU,QAAQ,CAACV,KAAvC;AACA,UAAIa,OAAO,GAAGF,SAAS,CAACP,MAAV,GAAiBM,QAAQ,CAACN,MAAxC,CAHmC,CAInC;AACA;AACA;;AACA,UAAIJ,KAAK,GAAGY,OAAO,GAAG,MAAKX,mBAAL,CAAyBD,KAA/C;AACA,UAAII,MAAM,GAAGS,OAAO,GAAG,MAAKZ,mBAAL,CAAyBG,MAAhD;AACA,UAAIZ,CAAC,GAAG,CAAC,CAAD,GAAKkB,QAAQ,CAAClB,CAAd,GAAkBoB,OAA1B;AACA,UAAInB,CAAC,GAAG,CAAC,CAAD,GAAKiB,QAAQ,CAACjB,CAAd,GAAkBoB,OAA1B;;AAEA,YAAKC,WAAL,CAAiB;AAACtB,QAAAA,CAAC,EAACA,CAAH;AAAKC,QAAAA,CAAC,EAACA,CAAP;AAASO,QAAAA,KAAK,EAACA,KAAf;AAAqBI,QAAAA,MAAM,EAACA;AAA5B,OAAjB,EAAqDE,QAArD;;AACA,YAAKI,QAAL,GAAgBA,QAAhB;AACA,KAvRiB;;AAAA,UAyRlBI,WAzRkB,GAyRJ,UAACC,QAAD,EAAUT,QAAV,EAAuB;AACpC,UAAGA,QAAQ,KAAK,KAAhB,EAAsB,CACrB;AACA;AACA;;AACD9B,MAAAA,OAAO,CAACC,GAAR,CAAY,4BAA0BsC,QAAQ,CAACvB,CAAnC,GAAqC,GAArC,GAAyCuB,QAAQ,CAACtB,CAAlD,GAAoD,GAApD,GAAwDsB,QAAQ,CAACf,KAAjE,GAAuE,GAAvE,GAA2Ee,QAAQ,CAACX,MAAhG;;AACA,YAAKY,QAAL,CAAc;AACbC,QAAAA,QAAQ,EAAC;AACRC,UAAAA,IAAI,EAACH,QAAQ,CAACvB,CADN;AAER2B,UAAAA,GAAG,EAACJ,QAAQ,CAACtB,CAFL;AAGRO,UAAAA,KAAK,EAACe,QAAQ,CAACf,KAHP;AAIRI,UAAAA,MAAM,EAACW,QAAQ,CAACX;AAJR;AADI,OAAd;;AAQA,YAAKW,QAAL,GAAgBA,QAAhB;AACA,KAxSiB;;AAAA,UA0SlBP,iBA1SkB,GA0SE,YAAM;AACzB,UAAG,MAAKY,YAAL,KAAsBC,SAAzB,EAAmC;AAClCC,QAAAA,MAAM,CAACC,YAAP,CAAoB,MAAKH,YAAzB;AACA;;AACD,YAAKA,YAAL,GAAoBC,SAApB;AACA,KA/SiB;;AAAA,UAiTlB3B,UAjTkB,GAiTL,UAACJ,CAAD,EAAO;AACnB;AACA;AACA;AAEA,UAAIkC,YAAY,GAAG,MAAKC,QAAL,EAAnB;;AACA,UAAIC,YAAY,GAAG,MAAKC,QAAL,EAAnB;;AACA,UAAIC,cAAc,GAAG,MAAKC,OAAL,EAArB;;AAEA,UAAIC,WAAW,GAAG,MAAK5B,GAAL,CAAS6B,UAA3B;AACA,UAAIC,UAAU,GAAG,MAAK9B,GAAL,CAAS8B,UAA1B;AACA,UAAIC,OAAO,GAAG,MAAK/B,GAAL,CAAS+B,OAAvB;;AAEA,YAAKzB,iBAAL,GAbmB,CAcnB;;;AACA,UAAG,MAAKN,GAAL,CAASgC,cAAZ,EAA2B;AAC1B1D,QAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ;AACA,OAFD,MAEK;AACJ,YAAIe,CAAC,GAAGF,CAAC,CAACC,WAAF,CAAc4C,OAAd,GAAwBX,YAAxB,GAAuC,MAAKd,QAAL,CAAclB,CAA7D;AACA,YAAIC,CAAC,GAAGH,CAAC,CAACC,WAAF,CAAc6C,OAAd,GAAwBV,YAAxB,GAAuC,MAAKhB,QAAL,CAAcjB,CAA7D;AACCjB,QAAAA,OAAO,CAACC,GAAR,CAAY,0CAAwCa,CAAC,CAACC,WAAF,CAAc4C,OAAtD,GAAgE,GAAhE,GAAoE7C,CAAC,CAACC,WAAF,CAAc6C,OAA9F;AACA5D,QAAAA,OAAO,CAACC,GAAR,CAAY,mDAAkD+C,YAAlD,GAAiE,GAAjE,GAAuEE,YAAvE,GAAsF,GAAtF,GAA2F,MAAKhB,QAAL,CAAclB,CAAzG,GAA6G,GAA7G,GAAiH,MAAKkB,QAAL,CAAcjB,CAA3I;AACAjB,QAAAA,OAAO,CAACC,GAAR,CAAY,iCAA+Be,CAA/B,GAAmC,GAAnC,GAAuCC,CAAnD;;AACD,cAAK4C,MAAL,CAAY7C,CAAZ,EAAcC,CAAd,EAAgBqC,WAAhB,EAA4BF,cAA5B,EAA2CK,OAA3C,EAAmDD,UAAnD;;AACA,cAAKM,gBAAL;AACA;;AACD,aAAO,KAAP;AACA,KA5UiB;;AAAA,UA+UlBC,aA/UkB,GA+UF,UAACjD,CAAD,EAAO;AACtB;AACA;AACA,UAAIkC,YAAY,GAAG,MAAKC,QAAL,EAAnB;;AACA,UAAIC,YAAY,GAAG,MAAKC,QAAL,EAAnB;;AACA,UAAIC,cAAc,GAAG,MAAKC,OAAL,EAArB;;AAEA,UAAIC,WAAW,GAAG,MAAK5B,GAAL,CAAS6B,UAA3B;AACA,UAAIC,UAAU,GAAG,MAAK9B,GAAL,CAAS8B,UAA1B;AACA,UAAIC,OAAO,GAAG,MAAK/B,GAAL,CAAS+B,OAAvB;;AAEA,YAAKzB,iBAAL;;AAEA,UAAMgC,KAAK,GAAGlD,CAAC,CAACC,WAAF,CAAckD,cAAd,CAA6B,CAA7B,CAAd,CAbsB,CAawB;AAC9C;;AACA,YAAKjC,iBAAL,GAfsB,CAgBtB;;;AACA,UAAG,MAAKN,GAAL,CAASgC,cAAZ,EAA2B,CAE1B,CAFD,MAEK;AACJ;AACA;AACA,YAAI1C,CAAC,GAAI,CAACgD,KAAK,CAACE,KAAN,GAAc,MAAK5C,UAApB,IAAkC0B,YAAlC,GAAiD,MAAKd,QAAL,CAAclB,CAAxE;AACA,YAAIC,CAAC,GAAI,CAAC+C,KAAK,CAACG,KAAN,GAAc,MAAK/C,SAApB,IAAiC8B,YAAjC,GAAgD,MAAKhB,QAAL,CAAcjB,CAAvE,CAJI,CAKJ;AACA;AACA;;AACA,cAAK4C,MAAL,CAAY7C,CAAZ,EAAcC,CAAd,EAAgBqC,WAAhB,EAA4BF,cAA5B,EAA2CK,OAA3C,EAAmDD,UAAnD;;AACA,cAAKM,gBAAL;AACA;;AACD,aAAO,KAAP;AACA,KA9WiB;;AAAA,UAgXlBA,gBAhXkB,GAgXE,YAAM;AACzB,YAAK9B,iBAAL;;AACA,UAAIY,YAAY,GAAG,MAAKlB,GAAL,CAASkB,YAA5B;AACA,YAAKA,YAAL,GAAoBE,MAAM,CAACsB,UAAP,CAAkB,MAAKvC,KAAvB,EAA6Be,YAA7B,CAApB;AACA,KApXiB;;AAAA,UAsXlBiB,MAtXkB,GAsXT,UAAC7C,CAAD,EAAGC,CAAH,EAAKqC,WAAL,EAAiBF,cAAjB,EAAgCK,OAAhC,EAAwCD,UAAxC,EAAuD;AAC/D;AACA;AACA;AAEA;AACA,UAAGF,WAAW,GAAGF,cAAd,GAA+BK,OAAlC,EAA0C;AACzC;AACA,YAAIvD,GAAG,GAAG,MAAKmE,UAAL,CAAgB;AAACrD,UAAAA,CAAC,EAACA,CAAH;AAAKC,UAAAA,CAAC,EAACA;AAAP,SAAhB,CAAV;;AAEA,YAAGf,GAAG,KAAK,IAAX,EAAgB;AACf;AACA;AACAF,UAAAA,OAAO,CAACC,GAAR,CAAY,0BAAZ;;AACA,gBAAKJ,KAAL,CAAWyE,iBAAX,CAA6BpE,GAA7B;;AACA,gBAAKQ,QAAL,CAAcR,GAAd;AACA;;AACD,cAAK2B,KAAL;;AACA;AACA,OAbD,MAaK;AACJ,cAAKI,oBAAL,GAA4B,KAA5B;AACA,YAAIsC,gBAAgB,GAAG,MAAKrC,QAAL,CAAcV,KAAd,GAAsB8B,WAA7C;AACA,YAAIkB,iBAAiB,GAAG,MAAKtC,QAAL,CAAcN,MAAd,GAAuB0B,WAA/C;AAEA,YAAImB,SAAS,GAAGzD,CAAC,GAAGuD,gBAAgB,GAAC,CAArC;AACA,YAAIG,SAAS,GAAGzD,CAAC,GAAGuD,iBAAiB,GAAC,CAAtC;AAEA,YAAIG,eAAe,GAAG3D,CAAC,GAAIuD,gBAAgB,IAAIvD,CAAC,GAAG,MAAKkB,QAAL,CAAclB,CAAtB,CAAjB,GACnB,MAAKkB,QAAL,CAAcV,KADrB;AAEA,YAAIoD,eAAe,GAAG3D,CAAC,GAAGuD,iBAAiB,IAAIvD,CAAC,GAAG,MAAKiB,QAAL,CAAcjB,CAAtB,CAAlB,GAClB,MAAKiB,QAAL,CAAcN,MADrB;;AAEA,cAAKG,WAAL,CAAiB;AAChBP,UAAAA,KAAK,EAAE+C,gBADS;AAEhB3C,UAAAA,MAAM,EAAE4C,iBAFQ;AAGhBxD,UAAAA,CAAC,EAAE2D,eAAe,IAAI,IAAEnB,UAAN,CAAf,GAAmCiB,SAAS,GAAGjB,UAHlC;AAIhBvC,UAAAA,CAAC,EAAE2D,eAAe,IAAI,IAAEpB,UAAN,CAAf,GAAmCkB,SAAS,GAAGlB;AAJlC,SAAjB;AAMA;AACD,KA5ZiB;;AAAA,UAublBP,QAvbkB,GAubP,YAAK;AACf,aAAO,MAAKV,QAAL,CAAcf,KAAd,GAAsB,MAAKC,mBAAL,CAAyBD,KAAtD;AACA,KAzbiB;;AAAA,UA0blB2B,QA1bkB,GA0bP,YAAK;AACf,aAAO,MAAKZ,QAAL,CAAcX,MAAd,GAAuB,MAAKH,mBAAL,CAAyBG,MAAvD;AACA,KA5biB;;AAAA,UA6blByB,OA7bkB,GA6bR,YAAM;AACf,aAAOwB,IAAI,CAACC,GAAL,CAAS,MAAK7B,QAAL,EAAT,EAA0B,MAAKE,QAAL,EAA1B,CAAP;AACA,KA/biB;;AAAA,UAiclB4B,KAjckB,GAicV,UAACC,IAAD,EAAOC,QAAP,EAAiBC,KAAjB,EAA2B;AAClCD,MAAAA,QAAQ,GAAGA,QAAQ,IAAI,GAAvB;AACAC,MAAAA,KAAK,GAAGA,KAAK,IAAI,OAAjB,CAFkC,CAGlC;;AACA,YAAK1C,QAAL,CAAc;AACb2C,QAAAA,YAAY,EAAC;AACZC,UAAAA,OAAO,EAAE,IADG;AAEZF,UAAAA,KAAK,EAAEA;AAFK,SADA;AAKbG,QAAAA,WAAW,EAAEL;AALA,OAAd;;AAOAZ,MAAAA,UAAU,CACT,YAAW;AACV,aAAK5B,QAAL,CAAc;AACd2C,UAAAA,YAAY,EAAC;AACZC,YAAAA,OAAO,EAAE;AADG;AADC,SAAd;AAGA,OAJD,CAKCE,IALD,uDADS,EAOTL,QAPS,CAAV;AASA,KArdiB;;AAAA,UAudlBvE,QAvdkB,GAudP,UAACR,GAAD,EAAS;AACnB,UAAGA,GAAG,KAAK,QAAX,EAAqB;AACpB;AACA,cAAK6E,KAAL,CAAW,SAAX;AACA,OAHD,MAGO,IAAG7E,GAAG,KAAK,OAAX,EAAoB;AAC1B,cAAK6E,KAAL,CAAW,SAAX;AACA,OAFM,MAEA,IAAG7E,GAAG,KAAK,GAAX,EAAgB;AACtB,cAAK6E,KAAL,CAAW,SAAX;AACA,OAFM,MAEA;AACN,cAAKA,KAAL,CAAW7E,GAAX;AACA;AACD,KAleiB;;AASjB,UAAKqF,KAAL,GAAY;AACXC,MAAAA,MAAM,EAAE,KADG;AAEXC,MAAAA,iBAAiB,EAAE;AAACzE,QAAAA,CAAC,EAAC,CAAH;AAAKC,QAAAA,CAAC,EAAC,CAAP;AAASO,QAAAA,KAAK,EAAC,CAAf;AAAiBI,QAAAA,MAAM,EAAC;AAAxB,OAFR;AAEoC;AAC/CH,MAAAA,mBAAmB,EAAE;AAACD,QAAAA,KAAK,EAAC,CAAP;AAAUI,QAAAA,MAAM,EAAC;AAAjB,OAHV;AAG+B;AAC1C8D,MAAAA,SAAS,EAAE,CAJA;AAIG;AACd;AACA;AACAjD,MAAAA,QAAQ,EAAE;AACTC,QAAAA,IAAI,EAAC,CADI;AACFC,QAAAA,GAAG,EAAC,CADF;AAETnB,QAAAA,KAAK,EAAE,MAAK3B,KAAL,CAAW2B,KAFT;AAGTI,QAAAA,MAAM,EAAE,MAAK/B,KAAL,CAAW+B;AAHV,OAPC;AAYXuD,MAAAA,YAAY,EAAG;AACdC,QAAAA,OAAO,EAAE,CADK;AAEdF,QAAAA,KAAK,EAAE;AAFO,OAZJ;AAgBXG,MAAAA,WAAW,EAAG;AAhBH,KAAZ;AAmBA,UAAKpD,oBAAL,GAA6B,IAA7B;AACA,UAAKwD,iBAAL,GAAyB;AAACzE,MAAAA,CAAC,EAAC,CAAH;AAAKC,MAAAA,CAAC,EAAC;AAAP,KAAzB;AACA,UAAKQ,mBAAL,GAA2B;AAACD,MAAAA,KAAK,EAAC,CAAP;AAASI,MAAAA,MAAM,EAAC;AAAhB,KAA3B;AACA,UAAK+D,WAAL,GAAmB,MAAK9F,KAAL,CAAW8F,WAA9B,CA/BiB,CAiCjB;;AACA,UAAKC,WAAL,GAAmB,IAAnB;AACA,UAAKlE,GAAL,GAAW;AACVmE,MAAAA,aAAa,EAAE,CAAC,IAAD,EAAM,GAAN,CADL;AAEVtC,MAAAA,UAAU,EAAE,GAFF;AAGV5B,MAAAA,aAAa,EAAE,IAHL;AAIV8B,MAAAA,OAAO,EAAE,GAJC;AAKVqC,MAAAA,cAAc,EAAE,IALN;AAMVlD,MAAAA,YAAY,EAAE,IANJ;AAOVY,MAAAA,UAAU,EAAE,IAPF;AAQVuC,MAAAA,QAAQ,EAAE,GARA;AASVC,MAAAA,SAAS,EAAE,EATD;AAUVC,MAAAA,SAAS,EAAE,CAVD;AAWVC,MAAAA,sBAAsB,EAAE,CAXd;AAYVC,MAAAA,eAAe,EAAE;AAZP,KAAX;AAeA,UAAKC,aAAL,GAAqB,MAAKA,aAAL,CAAmBd,IAAnB,uDAArB;AACG,UAAKe,YAAL,GAAoB,MAAKA,YAAL,CAAkBf,IAAlB,uDAApB;AACA,UAAKgB,WAAL,GAAmB,MAAKA,WAAL,CAAiBhB,IAAjB,uDAAnB;AACA,UAAKiB,MAAL,GAAc,EAAd;AAEH,UAAKC,MAAL,GAAc,CAAd;AACA,UAAKC,MAAL,GAAc,CAAd,CAxDiB,CAyDjB;;AACA,UAAKC,MAAL,GAAc,MAAKA,MAAL,CAAYpB,IAAZ,uDAAd;AACA,UAAKxF,SAAL,GAAiB,MAAKA,SAAL,CAAewF,IAAf,uDAAjB;AACA,UAAKzE,aAAL,GAAqB,MAAKA,aAAL,CAAmByE,IAAnB,uDAArB;AA5DiB;AA6DjB;;;;kCAGaxE,C,EAAG;AAChB,UAAMkD,KAAK,GAAGlD,CAAC,CAACC,WAAF,CAAc4F,OAAd,CAAsB,CAAtB,CAAd;AACA,WAAKH,MAAL,GAAcxC,KAAK,CAAC4C,OAApB;AACA,WAAKH,MAAL,GAAczC,KAAK,CAAC6C,OAApB;AACA,WAAKN,MAAL,GAAc;AAAEvF,QAAAA,CAAC,EAAEgD,KAAK,CAAC4C,OAAX;AAAoB3F,QAAAA,CAAC,EAAE+C,KAAK,CAAC8C;AAA7B,OAAd,CAJgB,CAKhB;;AACA,WAAKtE,QAAL,CAAc;AAAEgD,QAAAA,MAAM,EAAE;AAAV,OAAd;AACC;;;iCAEW1E,C,EAAG;AACf,UAAIA,CAAC,CAACmD,cAAF,IAAoBnD,CAAC,CAACmD,cAAF,CAAiB8C,MAAzC,EAAiD;AAChD,YAAM/C,KAAK,GAAGlD,CAAC,CAACC,WAAF,CAAckD,cAAd,CAA6B,CAA7B,CAAd,CADgD,CAEhD;;AACA,aAAKsC,MAAL,CAAYS,OAAZ,GAAsB,IAAtB;AACA;AACD;;;iCAEYlG,C,EAAG;AACf,UAAIA,CAAC,CAACmD,cAAF,IAAoBnD,CAAC,CAACmD,cAAF,CAAiB8C,MAAzC,EAAiD;AAChD,YAAM/C,KAAK,GAAGlD,CAAC,CAACC,WAAF,CAAckD,cAAd,CAA6B,CAA7B,CAAd;AACAjE,QAAAA,OAAO,CAACC,GAAR,CAAY,mBAAmB+D,KAAK,CAAC4C,OAAzB,GAAmC,OAAnC,GAA6C5C,KAAK,CAAC6C,OAA/D;AACA,aAAKN,MAAL,CAAYS,OAAZ,GAAsB,IAAtB;AACA;AACD;;;gCAEWlG,C,EAAG;AACd,UAAMkD,KAAK,GAAGlD,CAAC,CAACC,WAAF,CAAckD,cAAd,CAA6B,CAA7B,CAAd;AACAjE,MAAAA,OAAO,CAACC,GAAR,CAAY,qBAAsB+D,KAAK,CAAC6C,OAA5B,GAAsC,mBAAtC,GAA4D,KAAKN,MAAL,CAAYtF,CAApF;AACA,UAAIgG,EAAE,GAAGjD,KAAK,CAAC4C,OAAN,GAAgB,KAAKJ,MAA9B;AACA,UAAIU,EAAE,GAAGlD,KAAK,CAAC6C,OAAN,GAAgB,KAAKJ,MAA9B;AACAzG,MAAAA,OAAO,CAACC,GAAR,CAAY,SAASgH,EAAT,GAAc,QAAd,GAAyBC,EAArC;;AACA,UAAI,KAAKX,MAAL,CAAYS,OAAhB,EAAyB;AACxB,YAAGnC,IAAI,CAACsC,GAAL,CAASF,EAAT,IAAe,KAAKvF,GAAL,CAASsE,SAA3B,EAAqC;AACpC,cAAGiB,EAAE,GAAG,CAAR,EAAU;AACT;AACA,iBAAKG,OAAL,CAAa,OAAb;AACApH,YAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ;AACA,WAJD,MAKK,IAAGgH,EAAE,GAAG,CAAR,EAAU;AACd;AACA,iBAAKG,OAAL,CAAa,MAAb;AACApH,YAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ;AACA;AACD,SAXD,MAYK,IAAG4E,IAAI,CAACsC,GAAL,CAASD,EAAT,IAAe,KAAKxF,GAAL,CAASuE,SAA3B,EAAqC;AACzC,cAAGiB,EAAE,GAAG,CAAR,EAAU;AACT;AACA,iBAAKE,OAAL,CAAa,MAAb;AACApH,YAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ;AACA,WAJD,MAKK,IAAGiH,EAAE,GAAG,CAAR,EAAW;AACf;AACA,iBAAKE,OAAL,CAAa,IAAb;AACApH,YAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ;AACA;AACD;;AACD,aAAKJ,KAAL,CAAWwH,QAAX,IAAuB,KAAKxH,KAAL,CAAWwH,QAAX,EAAvB;AACArH,QAAAA,OAAO,CAACC,GAAR,CAAY,kBAAkB+D,KAAK,CAAC4C,OAAxB,GAAkC,OAAlC,GAA4C5C,KAAK,CAAC6C,OAA9D;AACA,aAAKrE,QAAL,CAAc;AAAEgD,UAAAA,MAAM,EAAE;AAAV,SAAd;AACA,OA5BD,MA6BI;AACH,aAAKzB,aAAL,CAAmBjD,CAAnB;AACA;;AACA,WAAKyF,MAAL,GAAc,EAAd;AACD;;;4BAEOe,S,EAAU;AACjB,UAAGA,SAAS,IAAI,MAAhB,EAAuB;AACtB,YAAIpH,GAAG,GAAG,QAAV;AACA,aAAKL,KAAL,CAAWY,QAAX,CAAoBP,GAApB;AACA,OAHD,MAIK,IAAGoH,SAAS,IAAI,OAAhB,EAAwB,CAC5B,CADI,MAEA,IAAGA,SAAS,IAAI,IAAhB,EAAqB;AACzB,YAAIC,MAAM,GAAGC,QAAQ,CAACC,cAAT,CAAwB,cAAxB,EAAwCC,GAArD;AACA1H,QAAAA,OAAO,CAACC,GAAR,CAAY,aAAasH,MAAzB;;AACA,YAAIA,MAAM,CAACI,KAAP,CAAa,GAAb,EAAkBJ,MAAM,CAACI,KAAP,CAAa,GAAb,EAAkBZ,MAAlB,GAA2B,CAA7C,KAAmD,iBAAvD,EAAyE;AACxES,UAAAA,QAAQ,CAACC,cAAT,CAAwB,cAAxB,EAAwCC,GAAxC,GAA8C,uBAA9C;AACA,SAFD,MAGI;AACHF,UAAAA,QAAQ,CAACC,cAAT,CAAwB,cAAxB,EAAwCC,GAAxC,GAA+C,yBAA/C;AACA;AACD,OATI,MAUA,IAAGJ,SAAS,IAAI,MAAhB,EAAuB,CAC3B;AACD,K,CAED;AACA;;;;iCACoB;AAAA,UAALM,GAAK,QAAZC,MAAY;AACnB7H,MAAAA,OAAO,CAACC,GAAR,CAAY,wBAAsB2H,GAAG,CAACE,YAA1B,GAAuC,GAAvC,GAA2CF,GAAG,CAACG,aAA3D;AACA,WAAKtG,mBAAL,GAA2B;AAACD,QAAAA,KAAK,EAAGoG,GAAG,CAACE,YAAb;AAA2BlG,QAAAA,MAAM,EAACgG,GAAG,CAACG;AAAtC,OAA3B;AACA/H,MAAAA,OAAO,CAACC,GAAR,CAAY,iBAAe,KAAKwB,mBAAL,CAAyBD,KAAxC,GAA8C,GAA9C,GAAkD,KAAKC,mBAAL,CAAyBG,MAAvF;AACA,WAAKF,GAAL,CAASC,aAAT,GAAyB,KAAKgE,WAAL,CAAiBnE,KAAjB,GAAuB,KAAKC,mBAAL,CAAyBD,KAAzE;AACA,WAAKgB,QAAL,CAAc;AAACwF,QAAAA,cAAc,EACxB,KAAKrC,WAAL,CAAiBnE,KAAjB,GAAuB,KAAKC,mBAAL,CAAyBD;AADvC,OAAd;AAEA,WAAKK,KAAL;AACA;;;6BAyDO;AACP,UAAMoG,IAAI,GAAG,KAAK1G,kBAAL,EAAb;AACA,UAAM2G,KAAK,GAAG;AACb1G,QAAAA,KAAK,EAAEyG,IAAI,CAACzG,KADC;AAEbI,QAAAA,MAAM,EAAEqG,IAAI,CAACrG;AAFA,OAAd;AAIA,UAAMuD,YAAY,GAAG;AACpB3D,QAAAA,KAAK,EAAEyG,IAAI,CAACzG,KADQ;AAEpBI,QAAAA,MAAM,EAAEqG,IAAI,CAACrG,MAFO;AAGpBwD,QAAAA,OAAO,EAAE,KAAKG,KAAL,CAAWJ,YAAX,CAAwBC,OAHb;AAIpBF,QAAAA,KAAK,EAAE,KAAKK,KAAL,CAAWJ,YAAX,CAAwBD,KAJX;AAKpBiD,QAAAA,QAAQ,EAAGF,IAAI,CAACrG,MAAL,GAAY,GAAb,GAAkB;AALR,OAArB;AAOA,UAAMwG,WAAW,GAAG;AACnBD,QAAAA,QAAQ,EAAGF,IAAI,CAACrG,MAAL,GAAc;AADN,OAApB;AAGA5B,MAAAA,OAAO,CAACC,GAAR,CAAY,cAAagI,IAAI,CAACzG,KAA9B;AACA,aACC;AAAK,QAAA,SAAS,EAAC,WAAf;AAA2B,QAAA,KAAK,EAAE0G,KAAlC;AAAyC,QAAA,SAAS,EAAE,KAAKpI,SAAzD;AAAoE,QAAA,QAAQ,EAAC,GAA7E;AACE,QAAA,aAAa,EAAI,KAAKe,aADxB;AAEE,QAAA,YAAY,EAAE,KAAKuF,aAFrB;AAGE,QAAA,WAAW,EAAE,KAAKC,YAHpB;AAIE,QAAA,UAAU,EAAE,KAAKC,WAJnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAKC;AAAK,QAAA,EAAE,EAAC,cAAR;AAAuB,QAAA,SAAS,EAAC,IAAjC;AAAsC,QAAA,GAAG,EAAC,IAA1C;AACC,QAAA,GAAG,EAAC,yBADL;AACgC,QAAA,MAAM,EAAE,KAAKI,MAD7C;AAEG,QAAA,KAAK,EAAE,KAAKnB,KAAL,CAAW9C,QAFrB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QALD,EAQC;AAAK,QAAA,SAAS,EAAC,SAAf;AAAyB,QAAA,KAAK,EAAE0C,YAAhC;AAA8C,QAAA,uBAAuB,EAAE;AAACkD,UAAAA,MAAM,EAAE,KAAK9C,KAAL,CAAWF;AAApB,SAAvE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QARD,CADD;AAaA;;;+BAsKUiD,K,EAAO;AACjBtI,MAAAA,OAAO,CAACC,GAAR,CAAY,cAAcqI,KAAK,CAACtH,CAApB,GAAwB,aAAxB,GAAwCsH,KAAK,CAACrH,CAA1D;AACA,UAAIsH,YAAY,GAAG,KAAnB;AAAA,UAA0BC,gBAAgB,GAAG,IAA7C;AACA,UAAIC,8BAA8B,GAAG5D,IAAI,CAAC6D,GAAL,CAAS,KAAKhH,GAAL,CAASwE,sBAAlB,EAA0C,CAA1C,CAArC;AACAlG,MAAAA,OAAO,CAACC,GAAR,CAAY,qCAAqCwI,8BAAjD;AACA,UAAIE,IAAI,GAAGhJ,OAAO,CAACgJ,IAAnB;;AACA,WAAI,IAAIC,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGF,IAAI,CAAC5B,MAA1B,EAAkC6B,CAAC,GAACC,GAApC,EAAyCD,CAAC,EAA1C,EAA8C;AAC7C,YAAI1I,GAAG,GAAGyI,IAAI,CAACC,CAAD,CAAd;;AACA,YAAG1I,GAAG,CAACc,CAAJ,IAASsH,KAAK,CAACtH,CAAf,IAAoBd,GAAG,CAACe,CAAJ,IAASqH,KAAK,CAACrH,CAAnC,IAAwCf,GAAG,CAACc,CAAJ,GAAMd,GAAG,CAACsB,KAAV,IAAmB8G,KAAK,CAACtH,CAAjE,IAAsEd,GAAG,CAACe,CAAJ,GAAQf,GAAG,CAAC0B,MAAZ,IAAsB0G,KAAK,CAACrH,CAArG,EAAwG;AACvG,iBAAOf,GAAG,CAACA,GAAX;AACA,SAFD,MAEO;AACN,cAAI4I,YAAY,GAAG5I,GAAG,CAACc,CAAJ,GAAQd,GAAG,CAACsB,KAAJ,GAAU,CAArC;AACA,cAAIuH,YAAY,GAAG7I,GAAG,CAACe,CAAJ,GAAQf,GAAG,CAAC0B,MAAJ,GAAW,CAAtC;AACA,cAAIqF,EAAE,GAAGqB,KAAK,CAACtH,CAAN,GAAU8H,YAAnB;AACA,cAAI5B,EAAE,GAAGoB,KAAK,CAACrH,CAAN,GAAU8H,YAAnB;AACA,cAAIC,QAAQ,GAAGnE,IAAI,CAAC6D,GAAL,CAASzB,EAAT,EAAa,CAAb,IAAkBpC,IAAI,CAAC6D,GAAL,CAASxB,EAAT,EAAa,CAAb,CAAjC;;AACA,cAAG,CAACsB,gBAAgB,KAAK,IAArB,IAA6BQ,QAAQ,GAAGT,YAAzC,KAA0DS,QAAQ,GAAGP,8BAA8B,GAAG5D,IAAI,CAAC6D,GAAL,CAAS7D,IAAI,CAACoE,GAAL,CAAS/I,GAAG,CAACsB,KAAb,EAAoBtB,GAAG,CAAC0B,MAAxB,CAAT,EAA0C,CAA1C,CAAzG,EAAuJ;AACtJ2G,YAAAA,YAAY,GAAGS,QAAf;AACAR,YAAAA,gBAAgB,GAAGtI,GAAG,CAACA,GAAvB;AACA;AACD;AACD;;AACD,aAAOsI,gBAAP;AACA;;;;EAxbsB/I,KAAK,CAACyJ,S;;AAwe9B,eAAetJ,SAAf","sourcesContent":["\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport Keymaps from './keys.js'\n\n// Keyboard2,\n//\nclass Keyboard2 extends React.Component {\n\n\t// Constructor, normal constructor in java\n\tconstructor(props){\n\t\tsuper(props);\n\t\t// this is the state variables, which is very special in React.\n\t\t// In react, once the state variables has changed by calling setState(),\n\t\t// render() function is followed.\n\t\t// this.props is the property passing by their parent DOM in this case,\n\t\t// Watch class\n\n\t\t// Please have a look doZoom, setViewport, and setPosition functions\n\t\tthis.state ={\n\t\t swiped: false,\n\t\t original_position: {x:0,y:0,width:0,height:0}, //ignore\n\t\t original_dimensions: {width:0, height:0}, //ignore\n\t\t font_size: 0, // haven't use\n\t\t // When user touch or click, imgStyle value has changes so that\n\t\t // \tthe class re-render their html componenets\n\t\t imgStyle :{\n\t\t\t left:0,top:0,\n\t\t\t width: this.props.width,\n\t\t\t height: this.props.height\n\t\t },\n\t\t overlayStyle : {\n\t\t\t opacity: 0,\n\t\t\t color: \"white\"\n\t\t },\n\t\t overlayText : \"\"\n\t\t};\n\n\t\tthis.in_starting_position =  true;\n\t\tthis.original_position = {x:0,y:0};\n\t\tthis.original_dimensions = {width:0,height:0};\n\t\tthis.displaySize = this.props.displaySize;\n\n\t\t// this configuration is from original zoomboard code\n\t\tthis.keyboardImg = null;\n\t\tthis.env = {\n\t\t\tkeyboardNames: [\"ZB\",\"#\"],\n\t\t\tzoomFactor: 2.2,\n\t\t\toriginalScale: 0.12,\n\t\t\tmaxZoom: 1.0,\n\t\t\tresetOnMaxZoom: true,\n\t\t\tresetTimeout: 1000,\n\t\t\tcenterBias: 0.05,\n\t\t\tanimTime: 0.1,\n\t\t\tminSwipeX: 40,\n\t\t\tminSwipeY: 1,\n\t\t\tmax_key_error_distance: 2,\n\t\t\tuseRealKeyboard: true\n\t\t}\n\n\t\tthis._onTouchStart = this._onTouchStart.bind(this);\n    \tthis._onTouchMove = this._onTouchMove.bind(this);\n    \tthis._onTouchEnd = this._onTouchEnd.bind(this);\n    \tthis._swipe = {};\n\n\t\tthis.startX = 0;\n\t\tthis.startY = 0;\n\t\t// register Event\n\t\tthis.onLoad = this.onLoad.bind(this);\n\t\tthis.onKeyDown = this.onKeyDown.bind(this);\n\t\tthis.onPointerDown = this.onPointerDown.bind(this);\n\t}\n\n\n\t_onTouchStart(e) {\n\t\tconst touch = e.nativeEvent.touches[0];\n\t\tthis.startX = touch.clientX;\n\t\tthis.startY = touch.clientY;\n\t\tthis._swipe = { x: touch.clientX, y: touch.clentY };\n\t\t// console.log(\"touch start x: \" + touch.clientX + \"; y: \" + touch.clientY);\n\t\tthis.setState({ swiped: false });\n\t\t}\n\n\t_onTouchMove(e) {\n\t\tif (e.changedTouches && e.changedTouches.length) {\n\t\t\tconst touch = e.nativeEvent.changedTouches[0];\n\t\t\t// console.log(\"touch move x: \" + touch.clientX + \"; y: \" + touch.clientY);\n\t\t\tthis._swipe.swiping = true;\n\t\t}\n\t}\n\n\t_onTouchMove(e) {\n\t\tif (e.changedTouches && e.changedTouches.length) {\n\t\t\tconst touch = e.nativeEvent.changedTouches[0];\n\t\t\tconsole.log(\"touch move x: \" + touch.clientX + \"; y: \" + touch.clientY);\n\t\t\tthis._swipe.swiping = true;\n\t\t}\n\t}\n\n\t_onTouchEnd(e) {\n\t\tconst touch = e.nativeEvent.changedTouches[0];\n\t\tconsole.log(\" touch.clientY: \" +  touch.clientY + \"; this._swipe.y: \" + this._swipe.y);\n\t\tvar dx = touch.clientX - this.startX;\n\t\tvar dy = touch.clientY - this.startY;\n\t\tconsole.log(\"dx: \" + dx + \"; dy: \" + dy);\n\t\tif (this._swipe.swiping) {\n\t\t\tif(Math.abs(dx) > this.env.minSwipeX){\n\t\t\t\tif(dx > 0){\n\t\t\t\t\t//swipe to the right\n\t\t\t\t\tthis.onSwipe(\"right\");\n\t\t\t\t\tconsole.log(\"right\");\n\t\t\t\t}\n\t\t\t\telse if(dx < 0){\n\t\t\t\t\t//swipe to the Left\n\t\t\t\t\tthis.onSwipe(\"left\");\n\t\t\t\t\tconsole.log(\"left\");\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if(Math.abs(dy) > this.env.minSwipeY){\n\t\t\t\tif(dy > 0){\n\t\t\t\t\t//swipe down\n\t\t\t\t\tthis.onSwipe(\"down\");\n\t\t\t\t\tconsole.log(\"swipe down\");\n\t\t\t\t}\n\t\t\t\telse if(dy < 0) {\n\t\t\t\t\t//swipe up\n\t\t\t\t\tthis.onSwipe(\"up\");\n\t\t\t\t\tconsole.log(\"swipe up\");\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.props.onSwiped && this.props.onSwiped();\n\t\t\tconsole.log(\"touch end x: \" + touch.clientX + \"; y: \" + touch.clientY);\n\t\t\tthis.setState({ swiped: true });\n\t\t}\n\t\telse{\n\t\t\tthis.onFingerTouch(e);\n\t\t}\n\t\t\tthis._swipe = {};\n\t}\n\n\tonSwipe(direction){\n\t\tif(direction == \"left\"){\n\t\t\tvar key = \"delete\";\n\t\t\tthis.props.callback(key);\n\t\t}\n\t\telse if(direction == \"right\"){\n\t\t}\n\t\telse if(direction == \"up\"){\n\t\t\tvar imgSrc = document.getElementById(\"keyboardtype\").src;\n\t\t\tconsole.log(\"imgSrc: \" + imgSrc);\n\t\t\tif( imgSrc.split(\"/\")[imgSrc.split(\"/\").length - 1] == \"ZoomBoard3b.png\"){\n\t\t\t\tdocument.getElementById(\"keyboardtype\").src = \"/images/symbols3b.png\";\n\t\t\t}\n\t\t\telse{\n\t\t\t\tdocument.getElementById(\"keyboardtype\").src =  \"/images/ZoomBoard3b.png\";\n\t\t\t}\n\t\t}\n\t\telse if(direction == \"down\"){\n\t\t}\n\t}\n\n\t// When the image is loaded, we recalculate the img size to fit into our\n\t// \tfixed width and height\n\tonLoad({target:img}){\n\t\tconsole.log(\"image naturalSize: \"+img.naturalWidth+\":\"+img.naturalHeight);\n\t\tthis.original_dimensions = {width : img.naturalWidth, height:img.naturalHeight};\n\t\tconsole.log(\"[onLoad]  - \"+this.original_dimensions.width+\":\"+this.original_dimensions.height);\n\t\tthis.env.originalScale = this.displaySize.width/this.original_dimensions.width;\n\t\tthis.setState({original_scale:\n\t\t\t\t\t\t\tthis.displaySize.width/this.original_dimensions.width});\n\t\tthis.reset();\n\t}\n\n\tonKeyDown = (ev) => {\n\t\tconsole.log(\"Key pressed: \" + ev.key + \"/\" +ev.keyCode);\n\t\tif(ev.keyCode === 37){\n\t\t\tconsole.log(\"[KeyPressed] Left arrow clicked\");\n\t\t}else if(ev.keyCode === 38){\n\t\t\tconsole.log(\"[KeyPressed] Top arrow clicked\");\n\t\t}else if(ev.keyCode === 39){\n\t\t\tconsole.log(\"[KeyPressed] Right arrow clicked\");\n\t\t}else if(ev.keyCode === 40){\n\t\t\tconsole.log(\"[KeyPressed] Down arrow clicked\");\n\t\t}else{\n\t\t\tvar key = String.fromCharCode(ev.keyCode).toLocaleLowerCase();\n\t\t\tif(ev.keyCode === 8){\n\t\t\t\tev.returnValue = false;\n\t\t\t\tev.cancleBubble = true;\n\t\t\t\tkey = \"delete\";\n\t\t\t}else if(ev.keyCode === 13){\n\t\t\t\tkey = \"Enter\";\n\t\t\t}\n\t\t\t// trigger\n\t\t\tthis.props.callback(key);\n\t\t\t// flash\n\t\t\tthis.flashKey(key);\n\t\t\tev.preventDefault();\n\t\t\tev.stopPropagation();\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t// mouse click event is handled here.\n\tonPointerDown = (e) => {\n\t\t//console.log(\"[PointerDown]clientXY: \"+e.clientX + \":\"+e.clientY + \" - pageXY: \"+e.pageX+\n\t\t//\":\" +e.pageY + \"- screenXY: \"+e.screenX+\":\"+e.screenY + \"- offsetXY: \"+e.nativeEvent.offsetX);\n\t\tconsole.log(\"[PointerDown] xy - \"+e.nativeEvent.x + \"/\"+e.nativeEvent.y);\n\t\t//console.log(\"this.position.value: \"+this.viewport.x +\":\"+this.viewport.y);\n\t\t//console.log(\"currentZoomLevel: \"+(this.position.width)+\":\"+this.original_dimensions.width);\n\t\t// use e.nativeEvent.offsetX,Y for accuracy\n\t\t//var x = e.nativeEvent.offsetX / (this.position.width/this.original_dimensions.width);\n\t\t//var y = e.nativeEvent.offsetY / (this.position.height/this.original_dimensions.height);\n\t\t//this.getKeyChar({x:x,y:y});\n\t\tthis.onKeyClick(e);\n\t\t//e.preventDefault();\n\t\t//e.stopPropagation();\n\t}\n\n\tcomponentDidUpdate = () => {\n\t\tconsole.log(\"========componentDidUpdate=======\");\n\t\t/*\n\t\twindow.setTimeout(() => {\n\t\t\tconsole.log(\"timeout\");\n\t\t},500);*/\n\t\tthis.offsetTop = ReactDOM.findDOMNode(this).offsetTop;\n\t\tthis.offsetLeft = ReactDOM.findDOMNode(this).offsetLeft;\n\t}\n\n\trender(){\n\t\tconst size = this.getWindowDimension();\n\t\tconst style = {\n\t\t\twidth: size.width,\n\t\t\theight: size.height,\n\t\t};\n\t\tconst overlayStyle = {\n\t\t\twidth: size.width,\n\t\t\theight: size.height,\n\t\t\topacity: this.state.overlayStyle.opacity,\n\t\t\tcolor: this.state.overlayStyle.color,\n\t\t\tfontSize: (size.height/1.2)+\"px\"\n\t\t};\n\t\tconst font_height = {\n\t\t\tfontSize : size.height / 1.2\n\t\t};\n\t\tconsole.log(\"[render] \" +size.width);\n\t\treturn(\n\t\t\t<div className=\"container\" style={style} onKeyDown={this.onKeyDown} tabIndex=\"0\"\n\t\t\t\t\tonPointerDown = {this.onPointerDown}\n\t\t\t\t\tonTouchStart={this._onTouchStart}\n\t\t\t\t\tonTouchMove={this._onTouchMove}\n\t\t\t\t\tonTouchEnd={this._onTouchEnd}>\n\t\t\t\t<img id=\"keyboardtype\" className=\"KB\" alt=\"kb\"\n\t\t\t\t\tsrc=\"/images/ZoomBoard3b.png\"  onLoad={this.onLoad}\n\t\t\t\t\t\t\tstyle={this.state.imgStyle}/>\n\t\t\t\t<div className=\"overlay\" style={overlayStyle} dangerouslySetInnerHTML={{__html: this.state.overlayText}}>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t)\n\t}\n\n\tgetWindowDimension = () => {\n\t\treturn {\n\t\t\twidth: this.original_dimensions.width * this.env.originalScale,\n\t\t\theight: this.original_dimensions.height * this.env.originalScale\n\t\t};\n\t}\n\n\treset = (animated) => {\n\t\t// console.log(\"[Reset] reser called.. originDim - \"+this.original_dimensions.width+\":\"+this.original_dimensions.height);\n\t\tthis.setViewPort({x:0 , y:0, width: this.original_dimensions.width, height:this.original_dimensions.height},\n\t\t\tanimated === true);\n\t\tthis.clearResetTimeout();\n\t\tthis.in_starting_position = true;\n\t}\n\n\tsetViewPort = (viewport,animated) =>{\n\t\tvar windowDim = this.getWindowDimension();\n\t\tvar scale_x = windowDim.width/viewport.width;\n\t\tvar scale_y = windowDim.height/viewport.height;\n\t\t// console.log(\"windowDim - \"+windowDim.width +\":\"+windowDim.height);\n\t\t// console.log(\"[setViewport] called.. originDim - \"+viewport.width+\":\"+viewport.height);\n\t\t// console.log(\"Scale XY - \"+scale_x +\":\"+scale_y);\n\t\tvar width = scale_x * this.original_dimensions.width;\n\t\tvar height = scale_y * this.original_dimensions.height;\n\t\tvar x = -1 * viewport.x * scale_x;\n\t\tvar y = -1 * viewport.y * scale_y;\n\n\t\tthis.setPosition({x:x,y:y,width:width,height:height},animated);\n\t\tthis.viewport = viewport;\n\t}\n\n\tsetPosition = (position,animated) => {\n\t\tif(animated === false){\n\t\t\t//img.css -webkit-transition none\n\t\t\t//img.css -webkit-transition all 0.001s ease-out\n\t\t}\n\t\tconsole.log(\"Left/Top/Width/Height: \"+position.x+\"/\"+position.y+\"/\"+position.width+\"/\"+position.height);\n\t\tthis.setState({\n\t\t\timgStyle:{\n\t\t\t\tleft:position.x,\n\t\t\t\ttop:position.y,\n\t\t\t\twidth:position.width,\n\t\t\t\theight:position.height\n\t\t\t}\n\t\t})\n\t\tthis.position = position;\n\t}\n\n\tclearResetTimeout = () => {\n\t\tif(this.resetTimeout !== undefined){\n\t\t\twindow.clearTimeout(this.resetTimeout);\n\t\t}\n\t\tthis.resetTimeout = undefined;\n\t}\n\n\tonKeyClick = (e) => {\n\t\t//e.preventDefault();\n\t\t//e.stopPropagation();\n\t\t// console.log(\"[2Click before doZoom] eventOffset => \"+e.nativeEvent.offsetX + \"/\"+e.nativeEvent.offsetY);\n\n\t\tvar currentZoomX = this.getXZoom();\n\t\tvar currentZoomY = this.getYZoom();\n\t\tvar currentZoomVal = this.getZoom();\n\n\t\tvar scaleFactor = this.env.zoomFactor;\n\t\tvar centerBias = this.env.centerBias;\n\t\tvar maxZoom = this.env.maxZoom;\n\n\t\tthis.clearResetTimeout();\n\t\t//Assuming mouse\n\t\tif(this.env.isTouchEnabled){\n\t\t\tconsole.log(\"true\");\n\t\t}else{\n\t\t\tvar x = e.nativeEvent.offsetX / currentZoomX + this.viewport.x;\n\t\t\tvar y = e.nativeEvent.offsetY / currentZoomY + this.viewport.y;\n\t\t\t console.log(\"[Click before doZoom] eventOffset => \"+e.nativeEvent.offsetX + \"/\"+e.nativeEvent.offsetY);\n\t\t\t console.log(\"[Click before doZoom] curZoom and Viewport => \"+ currentZoomX + \"/\" + currentZoomY + \"/\"+ this.viewport.x + \"/\"+this.viewport.y);\n\t\t\t console.log(\"[Click before doZoom] xy => \"+x + \"/\"+y);\n\t\t\tthis.doZoom(x,y,scaleFactor,currentZoomVal,maxZoom,centerBias);\n\t\t\tthis.resetTimeoutFunc();\n\t\t}\n\t\treturn false;\n\t}\n\n\n\tonFingerTouch = (e) => {\n\t\t//e.preventDefault();\n\t\t//e.stopPropagation();\n\t\tvar currentZoomX = this.getXZoom();\n\t\tvar currentZoomY = this.getYZoom();\n\t\tvar currentZoomVal = this.getZoom();\n\n\t\tvar scaleFactor = this.env.zoomFactor;\n\t\tvar centerBias = this.env.centerBias;\n\t\tvar maxZoom = this.env.maxZoom;\n\n\t\tthis.clearResetTimeout();\n\n\t\tconst touch = e.nativeEvent.changedTouches[0];//e.nativeEvent.changedTouches[0];\n\t\t// console.log(\"touch start x: \" + touch.clientX + \"; y: \" + touch.clientY);\n\t\tthis.clearResetTimeout();\n\t\t//Assuming mouse\n\t\tif(this.env.isTouchEnabled){\n\n\t\t}else{\n\t\t\t//pageX includes scroll offset Value\n\t\t\t// console.log(\"[offset] - \"+this.offsetLeft + \"/\" + this.offsetTop);\n\t\t\tvar x =  (touch.pageX - this.offsetLeft) / currentZoomX + this.viewport.x;\n\t\t\tvar y =  (touch.pageY - this.offsetTop) / currentZoomY + this.viewport.y;\n\t\t\t//console.log(\"[Click before doZoom] touchXY => \"+touch.clientX + \"/\"+touch.clientY);\n\t\t\t// console.log(\"[Click before doZoom] curZoom and Viewport => \"+ currentZoomX + \"/\" + currentZoomY + \"/\"+ this.viewport.x + \"/\"+this.viewport.y);\n\t\t\t// console.log(\"[Click before doZoom] xy => \"+x + \"/\"+y);\n\t\t\tthis.doZoom(x,y,scaleFactor,currentZoomVal,maxZoom,centerBias);\n\t\t\tthis.resetTimeoutFunc();\n\t\t}\n\t\treturn false;\n\t}\n\n\tresetTimeoutFunc =  () => {\n\t\tthis.clearResetTimeout();\n\t\tvar resetTimeout = this.env.resetTimeout;\n\t\tthis.resetTimeout = window.setTimeout(this.reset,resetTimeout);\n\t}\n\n\tdoZoom = (x,y,scaleFactor,currentZoomVal,maxZoom,centerBias) => {\n\t\t//var zoomtouch_event = jQuery.Event(\"zb_zoom\")\n\t\t//zoomtouch_event.x = x;, zoomtouch_event.y = y;\n\t\t//this.element.trigger(zoomtouch_event);\n\n\t\t// console.log(\"[Debug] scaleFactor/ CurrnetZoomVal / maxZoom -> \" + scaleFactor + \"/ \"+currentZoomVal +\"/ \"+maxZoom);\n\t\tif(scaleFactor * currentZoomVal > maxZoom){\n\t\t\t//console.log(\"Exceeded maxZoom \");\n\t\t\tvar key = this.getKeyChar({x:x,y:y});\n\n\t\t\tif(key !== null){\n\t\t\t\t//this.element.trigger(zoomkey_event);\n\t\t\t\t//this.flashkey(zoomkey_event.key);\n\t\t\t\tconsole.log(\"[doZoom] Key is not null\");\n\t\t\t\tthis.props.onKeyCharReceived(key);\n\t\t\t\tthis.flashKey(key);\n\t\t\t}\n\t\t\tthis.reset();\n\t\t\treturn;\n\t\t}else{\n\t\t\tthis.in_starting_position = false;\n\t\t\tvar newViewportWidth = this.viewport.width / scaleFactor ;\n\t\t\tvar newViewportHeight = this.viewport.height / scaleFactor;\n\n\t\t\tvar centeredX = x - newViewportWidth/2;\n\t\t\tvar centeredY = y - newViewportHeight/2;\n\n\t\t\tvar biasedViewportX = x - (newViewportWidth * (x - this.viewport.x))/\n\t\t\t\t\t\t\t\t\t\tthis.viewport.width;\n\t\t\tvar biasedViewportY = y- (newViewportHeight * (y - this.viewport.y))/\n\t\t\t\t\t\t\t\t\t\tthis.viewport.height;\n\t\t\tthis.setViewPort({\n\t\t\t\twidth: newViewportWidth,\n\t\t\t\theight: newViewportHeight,\n\t\t\t\tx: biasedViewportX * (1-centerBias) + centeredX * centerBias,\n\t\t\t\ty: biasedViewportY * (1-centerBias) + centeredY * centerBias,\n\t\t\t});\n\t\t}\n\t}\n\n\tgetKeyChar(point) {\n\t\tconsole.log(\"point.x: \" + point.x + \"; point.y: \" + point.y);\n\t\tvar min_distance = false, min_distance_key = null;\n\t\tvar max_key_error_distance_squared = Math.pow(this.env.max_key_error_distance, 2);\n\t\tconsole.log(\"max_key_error_distance_squared: \" + max_key_error_distance_squared);\n\t\tvar keys = Keymaps.keys;\n\t\tfor(var i = 0, len = keys.length; i<len; i++) {\n\t\t\tvar key = keys[i];\n\t\t\tif(key.x <= point.x && key.y <= point.y && key.x+key.width >= point.x && key.y + key.height >= point.y) {\n\t\t\t\treturn key.key;\n\t\t\t} else {\n\t\t\t\tvar key_center_x = key.x + key.width/2;\n\t\t\t\tvar key_center_y = key.y + key.height/2;\n\t\t\t\tvar dx = point.x - key_center_x;\n\t\t\t\tvar dy = point.y - key_center_y;\n\t\t\t\tvar dsquared = Math.pow(dx, 2) + Math.pow(dy, 2);\n\t\t\t\tif((min_distance_key === null || dsquared < min_distance) && dsquared < max_key_error_distance_squared * Math.pow(Math.min(key.width, key.height), 2)) {\n\t\t\t\t\tmin_distance = dsquared;\n\t\t\t\t\tmin_distance_key = key.key;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn min_distance_key;\n\t}\n\n\tgetXZoom = () =>{\n\t\treturn this.position.width / this.original_dimensions.width;\n\t}\n\tgetYZoom = () =>{\n\t\treturn this.position.height / this.original_dimensions.height;\n\t}\n\tgetZoom = () => {\n\t\treturn Math.max(this.getXZoom(), this.getYZoom());\n\t}\n\n\tflash = (text, duration, color) => {\n\t\tduration = duration || 250;\n\t\tcolor = color || \"white\";\n\t\t//window.clearTimeout(this.flashTimeout);\n\t\tthis.setState({\n\t\t\toverlayStyle:{\n\t\t\t\topacity: 0.95,\n\t\t\t\tcolor: color\n\t\t\t},\n\t\t\toverlayText: text\n\t\t});\n\t\tsetTimeout(\n\t\t\tfunction() {\n\t\t\t\tthis.setState({\n\t\t\t\toverlayStyle:{\n\t\t\t\t\topacity: 0}})\n\t\t\t}\n\t\t\t.bind(this),\n\t\t\tduration\n\t\t);\n\t}\n\n\tflashKey = (key) => {\n\t\tif(key === \"delete\") {\n\t\t\t//this.flash(\"&#9224;\");\n\t\t\tthis.flash(\"&#x232B\");\n\t\t} else if(key === \"enter\") {\n\t\t\tthis.flash(\"&#9252;\");\n\t\t} else if(key === \" \") {\n\t\t\tthis.flash(\"&#9251;\");\n\t\t} else {\n\t\t\tthis.flash(key);\n\t\t}\n\t}\n}\n\nexport default Keyboard2;\n"]},"metadata":{},"sourceType":"module"}